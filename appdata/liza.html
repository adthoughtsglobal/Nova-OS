<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lizabot 3</title>
    <meta name="permissions" content="unsandboxed">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300&display=swap');

        :root {
            --font-size-small: 0.85rem;
            --font-size-normal: 1rem;
            --font-size-subheading: 1.25rem;
            --font-size-big: 2rem;

            --colors-BG-normal: #101010;
            --colors-BG-sub: #262626;
            --colors-BG-section: #171717;
            --colors-BG-highlighted: #44403C;
            --colors-text-high: #44403C;
            --colors-text-normal: white;
            --colors-special-good: #49ac49;
            --colors-special-bad: #ac4949;

            --sizing-border-radius: 0.5rem;

            --sizing-huge: 1rem;
            --sizing-normal: 0.5rem;
            --sizing-nano: 0.3rem;

            --time-action: .2s;

            --vw: 1vw;
            --vh: 1vh;
            --font-size-default: calc((var(--vw) + var(--vh)) / 2);
        }

        @media (max-width: 768px) {
            :root {
                --time-action: .5s;
            }
        }

        ::-webkit-scrollbar {
            width: var(--sizing-normal);
        }

        ::-webkit-scrollbar-track {
            background: var(--colors-BG-sub);
            border-radius: var(--sizing-border-radius);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--colors-BG-sub);
            border-radius: var(--sizing-border-radius);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--colors-BG-sub);
            cursor: grab;
        }

        ::-webkit-scrollbar-thumb:active {
            cursor: grabbing;
        }

        html {
            height: 100%;
            width: 100%;
            font-size: var(--font-size);
        }

        button,
        input,
        textarea {
            outline: none;
            font-family: inherit;
            font-size: inherit;
        }

        body {
            background-color: var(--colors-BG-normal);
            color: var(--colors-text-normal);
            user-select: none;
        }

        html {
            box-sizing: border-box;
            font-size: 16px
        }

        *,
        :after,
        :before {
            box-sizing: inherit;
            transition: .2s
        }

        body {
            line-height: 1.5;
            font-family: 'DM Sans', sans-serif;
            height: 100%;
            display: flex;
            width: 100%;
            margin: 0;
            flex-direction: column;
            padding: 1rem;
        }

        img,
        video {
            height: auto;
            max-width: 100%
        }

        dialog {
            box-shadow: rgba(0, 0, 0, .4) 0 2px 4px, rgba(0, 0, 0, .3) 0 7px 13px -3px, rgba(0, 0, 0, .2) 0 -3px 0 inset;
            animation: app .2s ease
        }

        dialog::backdrop {
            background-color: rgb(0 0 0 / 39%);
            backdrop-filter: blur(5px)
        }

        @keyframes app {
            0% {
                opacity: 0;
                transform: translateY(20px)
            }

            100% {
                opacity: 100%;
                transform: translateY(0)
            }
        }

        a:focus,
        button:focus,
        dialog:focus,
        input:focus,
        textarea:focus {
            outline: 0;
            color: inherit;
        }

        nav {
            margin-bottom: 10px
        }

        #chat {
            height: 0;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        #chatbox {
            height: 0;
            flex: 1;
            padding: 1rem;
            background-color: #1d1d1d;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            overflow-y: scroll;
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        #chinpt {
            width: 0;
            flex: 1;
            display: block;
            font-size: 15px;
            padding: 0.7rem 1rem;
            border-radius: 0.5rem;
            margin: auto;
            border: none;
            outline: 0;
            background-color: var(--colors-BG-sub);
        }

        .msgcon {
            background-color: var(--colors-BG-sub);
            border: 1px solid transparent;
            border-radius: 10px;
            padding: 5px 10px;
            transition: .2s
        }

        .msgcon:hover {
            background-color: var(--colors-BG-normal);
            border: 1px solid #1e90ff
        }

        .msgcon p {
            width: calc(100% - 61px);
            display: inline-block;
            transition: .2s;
            margin-left: 13px
        }

        .msgcon span {
            width: 35px;
            display: inline-block;
            transform: translate(2px, 10px);
            background-color: var(--colors-BG-section);
            color: var(--colors-text-normal);
            animation: pop .2s ease;
            float: left;
            padding: 5px;
            border-radius: 0.3rem;
            z-index: 2
        }

        div#cicon {
            display: flex;
            align-items: stretch;
            gap: 0.3rem;
        }

        .per {
            background-color: var(--colors-BG-normal) !important;

        }

        .sndbtn {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: transparent;
            color: #6f9cf7;
            border: 0;
            background-color: var(--colors-BG-sub);
            padding: 0.3rem;
            border-radius: 0.5rem;
        }

        [edbtn] {
            display: block;
            background: 0 0;
            border: 0;
            padding: 0;
            margin-top: 5px;
            color: #50a5fa;
            opacity: .5
        }

        [edbtn]:hover {
            color: #47a4ff
        }

        .msgcon:hover [edbtn] {
            opacity: 1
        }

        #cfdia {
            background-color: var(--colors-BG-normal);
            border: 2px solid #959faa;
            border-radius: 10px;
            padding-bottom: 9px;
            color: white;
            width: 90vw;
            box-shadow: rgb(28 88 143 / 24%) 0 2px 12px 0
        }

        #cfuqi {
            display: block;
            width: 100%;
            padding: 6px;
            font-size: 17px;
            border-radius: 8px;
            border: 1px solid #d3d3d3;
            margin-bottom: 10px;
            background: var(--colors-BG-normal);
            font-family: 'DM Sans', sans-serif
        }

        textarea#cftxt {
            display: block;
            width: 100%;
            padding: 6px;
            font-size: 17px;
            border-radius: 8px;
            border: 1px solid #d3d3d3;
            margin-bottom: 10px;
            resize: none;
            background: var(--colors-BG-normal);
            font-size: 17px;
            font-family: 'DM Sans', sans-serif
        }

        #cfdia button {
            display: block;
            width: 100%;
            border-radius: 10px;
            border: 1px solid #d3d3d3;
            padding: 10px;
            font-size: 15px;
            color: var(--colors-BG-normal);
            background-color: #6e8eac;
            margin-bottom: 10px;
            font-family: 'DM Sans', sans-serif
        }

        .esqc button {
            display: block;
            width: 100%;
            border-radius: 10px;
            padding: 10px;
            border: 1px solid #d3d3d3;
            color: var(--colors-BG-normal);
            background-color: #6d91b0;
            text-align: left;
            margin: 5px 0
        }

        .navb {
            float: right;
            font-size: 20px !important;
            padding: 3px;
            background-color: var(--colors-BG-sub);
            border-radius: 50%;
            transition: .2s;
            box-shadow: rgba(9, 30, 66, .25) 0 1px 1px, rgba(9, 30, 66, .13) 0 0 1px 1px;
            cursor: pointer
        }

        .navb:hover {
            box-shadow: rgba(0, 0, 0, .4) 0 2px 4px, rgba(0, 0, 0, .3) 0 7px 13px -3px, rgba(0, 0, 0, .2) 0 -3px 0 inset
        }

        #fxlib {
            background-color: var(--colors-BG-normal);
            border: 2px solid #959faa;
            border-radius: 10px;
            padding-bottom: 30px;
            color: #70788a;
            outline: 0;
            width: 90vw;
            box-shadow: rgba(18, 18, 18, 0.24) 0 2px 12px 0;
            max-width: 25rem;
        }

        cls {
            float: right;
            cursor: pointer
        }

        .pair {
            background-color: var(--colors-BG-highlighted);
            color: var(--colors-text-normal);
            padding: 5px 5px;
            border-radius: 10px;
            margin-top: 5px
        }

        .pair input {
            width: 34%;
            background-color: var(--colors-BG-sub);
            color: var(--colors-text-normal);
            outline: 0;
            border: 1px solid #add8e6;
            border-radius: 8px;
            padding: 5px
        }

        .pair a {
            float: right;
            color: #eaf5ff;
            font-size: 13px;
            padding: 1px 4px;
            border-radius: 5px;
            background: #8197ab;
            cursor: pointer;
            transform: translateY(0);
            margin-left: 5px
        }

        .pair a span {
            font-size: 22px !important;
            transform: translateY(4px)
        }

        .pair sup {
            transform: translateY(5px);
            margin: 0 7px;
            display: inline-block;
            font-family: monospace
        }

        #fxli center {
            margin-top: 10px
        }

        .adnf {
            margin-top: 10px;
            padding: 5px;
            border-radius: 50%;
            background-color: #72c0ff;
            color: var(--colors-text-normal);
            cursor: pointer
        }

        .custom-loader {
            width: 45px;
            height: 13px;
            --c: radial-gradient(farthest-side, #9AB6F4 90%, #0000);
            background: var(--c), var(--c), var(--c), var(--c);
            background-size: 10px 10px;
            display: inline-block;
            background-repeat: no-repeat;
            animation: d3 1s infinite linear;
            white-space: nowrap;
            overflow-x: hidden;
            margin-left: 5px
        }

        @keyframes d3 {
            0% {
                background-position: calc(0*100%/3) 50%, calc(1*100%/3) 50%, calc(2*100%/3) 50%, calc(3*100%/3) 50%
            }

            16.67% {
                background-position: calc(0*100%/3) 0, calc(1*100%/3) 50%, calc(2*100%/3) 50%, calc(3*100%/3) 50%
            }

            33.33% {
                background-position: calc(0*100%/3) 100%, calc(1*100%/3) 0, calc(2*100%/3) 50%, calc(3*100%/3) 50%
            }

            50% {
                background-position: calc(0*100%/3) 50%, calc(1*100%/3) 100%, calc(2*100%/3) 0, calc(3*100%/3) 50%
            }

            66.67% {
                background-position: calc(0*100%/3) 50%, calc(1*100%/3) 50%, calc(2*100%/3) 100%, calc(3*100%/3) 0
            }

            83.33% {
                background-position: calc(0*100%/3) 50%, calc(1*100%/3) 50%, calc(2*100%/3) 50%, calc(3*100%/3) 100%
            }

            100% {
                background-position: calc(0*100%/3) 50%, calc(1*100%/3) 50%, calc(2*100%/3) 50%, calc(3*100%/3) 50%
            }
        }

        .slrt {
            animation: app3 .5s ease;
            z-index: 0
        }

        @keyframes app3 {
            0% {
                transform: translate(0, 10px)
            }
        }

        @keyframes pop {
            0% {
                transform: scale(.7) translate(2px, 10px)
            }

            100% {
                transform: scale(1) translate(2px, 10px)
            }
        }

        @keyframes pops {
            0% {
                transform: scale(.7)
            }

            100% {
                transform: scale(1)
            }
        }

        .wikiacl {
            animation: pops .5s ease;
            padding: 10px;
            background-color: #758a98;
            color: var(--colors-BG-normal);
            border-radius: 10px;
            margin: 10px 0
        }

        .wikiacl a {
            color: var(--colors-text-normal)
        }

        a {
            color: white;
        }

        .morethings {
			grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 0.3rem;
            display: grid;
        }

        .morethings button {
    background: var(--colors-BG-highlighted);
    color: white;
    border: none;
    margin: 0;
    border-radius: 0.5rem;
    padding: 0.3rem 0.5rem;
}
    </style>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz@9..40&display=swap" rel="stylesheet">
</head>

<body>
    <nav><b>Lizabot 3 </b> <span id="subt"> Chat</span><span class="material-symbols-outlined navb"
            onclick="fxld()">function</span></nav>
    <div id="chat">
        <div id="chatbox">
            <div class="msgcon"><span class="material-symbols-outlined">robot_2</span>
                <p>Hello there! How can I help you today?</p>
            </div>
        </div>
        <div id="cicon"><input placeholder="Ask liza..." id="chinpt"><button onclick="chat()" class="sndbtn"><span
                    class="material-symbols-outlined">expand_circle_right</span></button></div>
    </div>
    <dialog id="cfdia">
        <cls onclick='gid("cfdia").close()'><span class="material-symbols-outlined">cancel</span></cls>
        <h1>Add a custom function</h1><span>When the user asks something like:</span><input placeholder="user query"
            id="cfuqi"><span>Reply:</span><textarea id="cftxt" placeholder="Please wait..."></textarea><button
            onclick="cfsv()">Save and ask that</button>
    </dialog>
    <dialog id="fxlib">
        <cls onclick='gid("fxlib").close()'><span class="material-symbols-outlined">cancel</span></cls>
        <h1>Custom Function Library</h1><b>Custom Messages</b>
        <div id="fxli"></div>
        <center><span class="material-symbols-outlined adnf" onclick="adnmf()">add</span></center>
    </dialog>
    <script>
        var buttons = [];
        function gid(e) {
            return document.getElementById(e);
        }

        function t(e) {
            document.title = e;
        }

        function cl(e) {
            console.log(e);
        }

        var msg = "",
            cslb = [],
            nowq = "",
            dataArray = [],
            elements,
            ldr = `<div class="custom-loader"></div>`,
            subt = gid('subt');

        async function initializeCslb() {

            const dataFromDatabase = await getdb("b", "cslb");

            if (dataFromDatabase) {
                cslb = dataFromDatabase;
            }
        }

        initializeCslb();

        function findValueByMatchingKey(cslb, e) {
            for (const item of cslb) {
                if (item.key === e) {
                    return item.value;
                }
            }

            return false;
        }

        function htmlformarray() {

            const htmlElements = cslb.map((item, index) => `
        <div class="pair">
            <sup>${index + 1}</sup>
            <input value="${item.key}">
            > 
            <input value="${item.value}">
            <a><span class="material-symbols-outlined" onclick="savdecf(${index}, 'save')"> save </span></a>
            <a><span class="material-symbols-outlined" onclick="savdecf(${index}, 'delete')"> delete </span></a>
        </div>`
            );

            if (cslb.length == 0) {
                return `<center>You do not have any saved functions yet. <br><br>Add a new one: </center>`
            }

            return htmlElements.join('');
        }

        async function chat() {
            buttons = [];
            const inputElem = gid("chinpt");
            const chatbox = gid("chatbox");
            const message = inputElem.value.trim();
            inputElem.value = "";
            t("Lizabot is typing...");
            subt.innerHTML = ldr;

            if (message) {
                displayMessage("user", message);
                chatbox.scrollTop = chatbox.scrollHeight;

                const response = await evaluateMessage(message);
                await displayMessage("bot", response);
            }

            chatbox.scrollTop = chatbox.scrollHeight;
            t("Lizabot 3");
            subt.innerHTML = "Chat";

            
        }

        document.getElementById("chinpt").addEventListener("keydown", function (event) {
            if (event.key === "Enter") chat();
        });

        async function evaluateMessage(message) {
            const normalizedMessage = message.toLowerCase();

            if (isWhatIsQuery(normalizedMessage) && (normalizedMessage.split(" ").length >= 1)) {
                const term = extractSearchTerm(normalizedMessage);
                const searchResult = await searchForDefinition(term);
                return searchResult || suggestAlternative(term);
            } else {
                let searchTerm = message;
                await window.parent.prepareArrayToSearch();
                if (searchTerm.toLowerCase().startsWith("open ")) {
                    const queryWords = searchTerm.split(" ");
                    if (queryWords.length >= 2) {
                        const targetName = queryWords.slice(1).join(" ").toLowerCase().trim();
                        let maxSimilarity = 0.5;
                        let mostSimilarFile = null;

                        window.parent.fileslist.forEach(item => {
                            const itemName = item.name.toLowerCase();
                            if (item.type !== "folder") {
                                const similarity = window.parent.calculateSimilarity(itemName, targetName);
                                if (similarity > maxSimilarity) {
                                    maxSimilarity = similarity;
                                    mostSimilarFile = item;
                                }
                            }
                        });

                        if (mostSimilarFile) {
                            await window.parent.openfile(mostSimilarFile.id);
                            return `Opening ${mostSimilarFile.name}...`;
                        } else {
                            return `No matching file found for "${targetName}".`;
                        }


                        cl("> no answers");
                        return "No relevant answers found.";
                    }
                }
            }

            const matchedResponse = await findResponse(normalizedMessage);
            return matchedResponse || suggestAlternative(message);
        }

        function isWhatIsQuery(message) {
            return /^(what is a|what is an|what is)\s/i.test(message);
        }

        function extractSearchTerm(query) {
            return query.replace(/^(what is an |what is a |what is )\s*/i, "").replace(/\?$/, "").trim();
        }

        async function searchForDefinition(term) {
            
            const wikiResult = await searchWikipedia(term);
            if (wikiResult) return wikiResult;

            const longmanDefinition = await fetchDefinition("longman", term);
            if (longmanDefinition) return formatDefinition("Longman", term, longmanDefinition);

            return null;
        }

        async function fetchDefinition(source, term) {
            if (source === "longman") {
                const url = `https://www.ldoceonline.com/dictionary/${term}`;
                return await fetchHTMLContent(url, ".DEF") || "The internet doesn't know what '" + term + "' is.";
            }
            return "The internet doesn't know what '" + term + "' is.";
        }

        async function searchWikipedia(term) {
            const apiUrl = `https://en.wikipedia.org/w/api.php?action=query&format=json&list=search&utf8=1&origin=*&srsearch=${encodeURIComponent(term)}`;
            const searchResults = await fetchJSON(apiUrl);

            if (searchResults?.query?.search.length) {
                const bestMatch = findBestMatch(term, searchResults.query.search);
                if (bestMatch) return await formatWikiResult(bestMatch);
            }
            return null;
        }

        function suggestAlternative(term) {
            return `Sorry, no information available for '${term}'. <a href="https://www.google.com/search?q=${term}">Search Google</a>`;
        }

        function formatDefinition(source, term, definition) {
            return `According to ${source}, '${term}' is defined as: ${definition}.`;
        }

        async function formatWikiResult(match) {
            const snippet = await fetchFullTextSnippet(match.title);
            return `<b>${match.title}</b>: ${snippet}... <a href="https://en.wikipedia.org/wiki/${match.title}">Learn more</a>`;
        }

        async function findResponse(message) {
            return null;
        }

        function findBestMatch(term, data) {
            const scores = data.map(item => ({ ...item, score: calculateSimilarity(term, item.title, "yes") }));
            scores.sort((a, b) => b.score - a.score);
            return scores[0]?.score > 0.5 ? scores[0] : null;
        }

        function calculateSimilarity(term1, term2, mhm) {
            if(mhm == "yes") {
                buttons.push(term2);
            }
            if (!term1 || !term2) {
                return 0;
            }
            const set1 = new Set(term1.toLowerCase().split(" "));
            const set2 = new Set(term2.toLowerCase().split(" "));
            const intersection = [...set1].filter(word => set2.has(word)).length;
            const union = set1.size + set2.size - intersection;
            return intersection / union;
        }

        async function fetchJSON(url) {
            const response = await fetch(url);
            return response.ok ? response.json() : null;
        }

        async function fetchHTMLContent(url, selector) {
            const response = await fetch(url);
            if (!response.ok) return null;

            const text = await response.text();
            const doc = new DOMParser().parseFromString(text, "text/html");
            const element = doc.querySelector(selector);
            return element?.textContent || null;
        }

        async function fetchFullTextSnippet(title) {
    const url = `https://en.wikipedia.org/w/api.php?action=query&format=json&prop=extracts&exintro=true&explaintext=true&titles=${encodeURIComponent(title)}&utf8=1&origin=*`;
    return (await fetchJSON(url))?.query?.pages?.[Object.keys((await fetchJSON(url)).query.pages)[0]]?.extract.split("\n").slice(0, 3).join("\n") || null;
}

        async function displayMessage(type, message) {
            const isBad = type === "bot" && await containsInappropriateContent(message);
            const formattedMessage = isBad
                ? `Sorry for an inappropriate message.`
                : message;

            const chatbox = gid("chatbox");

            const htmlElements = buttons.map((item) => `
        <button>${item}</button>`
            );
            let morethings = htmlElements.join('');
            chatbox.lastElementChild.insertAdjacentHTML("afterend", `
        <div class="msgcon">
            <span class="material-symbols-outlined ${type === "user" ? "per" : ""}">
                ${type === "user" ? "person" : "robot_2"}
            </span>
            <p>${formattedMessage}</p>
            <div class="morethings">
            ${morethings}
                </div>
        </div>
    `);
        }

        function executeEscCode(message) {
            const match = /\[esc-(.+)\]\$/.exec(message);
            if (match) {
                try {
                    eval(match[1]);
                } catch (error) {
                    console.error("Error executing code:", error);
                }
            }
            return message.replace(/\[esc-.*?\]\$/, "").trim();
        }

        async function fetchFirst5Lines(title) {
            const fullTextUrl = `https://en.wikipedia.org/w/api.php?action=query&format=json&prop=extracts&exintro=true&explaintext=true&titles=${encodeURIComponent(
                title
            )}&utf8=1&origin=*`;

            const response = await fetch(fullTextUrl, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",

                },
            });

            if (!response.ok) {
                throw new Error(`Network response was not ok: ${response.status}`);
            }

            const data = await response.json();
            const pageId = Object.keys(data.query.pages)[0];
            const fullText = data.query.pages[pageId].extract;

            if (fullText.includes("may refer to:")) {
                return `Please specify which ${title} you are talking about.`;
            }

            const sentences = fullText.split(/[.!?]/).filter(sentence => sentence.trim() !== '');
            const first5Sentences = sentences.slice(0, 5).join('. ');

            return first5Sentences.replace(/<\/?[^>]+(>|$)/g, ""); // Remove HTML tags
        }

        function openDB(databaseName, version) {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(databaseName, version);

                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    db.createObjectStore("store", { keyPath: "key" });
                };

                request.onsuccess = () => {
                    resolve(request.result);
                };

                request.onerror = () => {
                    reject(request.error);
                };
            });
        }

        function setdb(databaseName, key, value) {
            return openDB(databaseName, 1).then((db) => {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction(["store"], "readwrite");
                    const store = transaction.objectStore("store");
                    const request = store.put({ key, value });

                    request.onsuccess = () => {
                        resolve();
                    };

                    request.onerror = () => {
                        reject(request.error);
                    };
                });
            });
        }

        function getdb(databaseName, key) {
            return openDB(databaseName, 1).then((db) => {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction(["store"], "readonly");
                    const store = transaction.objectStore("store");
                    const request = store.get(key);

                    request.onsuccess = () => {
                        const result = request.result;
                        if (result) {
                            resolve(result.value);
                        } else {
                            resolve(null); // Key not found
                        }
                    };

                    request.onerror = () => {
                        reject(request.error);
                    };
                });
            });
        }

        async function cfd() {
            gid("cfdia").showModal();
            gid("cfuqi").value = nowq;
            gid("cftxt").value = await evalrobomsg(msg);
        }

        function cfsv() {
            cl("saved");
            let x = {};
            let cfuqiElement = gid("cfuqi");
            let cftxtElement = gid("cftxt");

            if (cfuqiElement && cftxtElement) {
                x.key = cfuqiElement.value || "";
                x.value = cftxtElement.value || "";

                if (Array.isArray(cslb)) {
                    cslb.push(x);
                    gid("cfdia").close();
                    displayMessage('bot',
                        "Learned what to do when you ask '" +
                        gid("cfuqi").value +
                        "'. As i have saved it in the local database, you will get this even if you reload or close this webpage."
                    );
                    setdb("b", "cslb", cslb)
                    gid("chinpt").setAttribute("desabled", "true");
                    setTimeout(reask, 1000);
                } else {
                    console.error("cslb is not an array.");
                }
            } else {
                console.error("Elements not found.");
            }
        }

        function savdecf(index, action) {

            const editedKey = document.querySelectorAll('.pair input')[index * 2].value;
            const editedValue = document.querySelectorAll('.pair input')[index * 2 + 1].value;

            if (action === 'save') {

                cslb[index].key = editedKey;
                cslb[index].value = editedValue;

                setdb("b", "cslb", cslb);
            } else if (action === 'delete') {

                cslb.splice(index, 1);

                setdb("b", "cslb", cslb);
            }
            fxld()
        }

        function reask() {
            gid("chinpt").value = gid("cfuqi").value;
            chat();
            gid("chinpt").setAttribute("desabled", "false");
            cl("re asked and re answered question");
        }

        function ask(e) {
            gid("chinpt").value = e;
            chat();
        }

        async function containsInappropriateContent(text) {
            if (!text) {
                return;
            }

            const response = await fetch(
                "https://raw.githubusercontent.com/LDNOOBW/List-of-Dirty-Naughty-Obscene-and-Otherwise-Bad-Words/master/en"
            );

            if (!response.ok) {
                throw new Error("Failed to fetch bad words list");
            }

            const badWords = await response.text().then((data) => data.split("\n"));

            const lowerCaseText = text.toLowerCase();

            for (const word of badWords) {
                const lowerCaseWord = word.trim().toLowerCase();
                if (lowerCaseWord && lowerCaseText.includes(" " + lowerCaseWord + " ")) {
                    console.log(`Bad word detected: ${lowerCaseWord}`);
                    return true; // Bad words detected
                }
            }

            return false; // No bad words detected
        }

        function fxld() {
            gid('fxlib').showModal();
            let x = htmlformarray();
            gid('fxli').innerHTML = x;
        }

        async function adnmf() {
            const arr = ["just as fine as yours.", "not that great, my cables are pretty bad.", "really exhausting - what about yours?"];
            gid("cfdia").showModal();
            gid("cfuqi").value = "How is your day going?";
            gid("cftxt").value = arr[Math.floor(Math.random() * arr.length)];
        }</script>
</body>

</html>